#!/bin/bash
# Security pre-commit hook - blocks commits containing secrets
# Installed by manage-security skill

# Check if ggshield is installed
if ! command -v ggshield &> /dev/null; then
    echo "Warning: ggshield not installed, skipping secret scan"
    echo "Install with: brew install gitguardian/tap/ggshield"
    exit 0
fi

# Run ggshield on staged files
echo "Scanning for secrets..."
ggshield secret scan pre-commit

exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo ""
    echo "Secret detected! Commit blocked."
    echo "Remove the secret and try again."
    echo ""
    echo "If this is a false positive, you can:"
    echo "  1. Add to .gitguardian.yaml allowlist"
    echo "  2. Use: git commit --no-verify (not recommended)"
fi

exit $exit_code
